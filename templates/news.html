<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>新聞卡片網頁</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background-color: #121212;
        color: #ffffff;
      }

      .container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        padding: 20px;
      }

      .card {
        background-color: #1e1e1e;
        width: 380px;
        margin: 10px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        transition: transform 0.3s;
      }

      .card:hover {
        transform: translateY(-5px);
      }

      .card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
      }

      .card-content {
        padding: 15px;
      }

      .card-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
        line-height: 1.4;
      }

      .card-meta {
        font-size: 14px;
        color: #bbbbbb;
      }
    </style>
  </head>

  <body>
    <div class="container" id="news-container">
      <!-- API 資料卡片將注入到這裡 -->
    </div>

    <script>
      let offset = 0; // 起始位置
      const limit = 10; // 每次加載的數量
      const isLoading = { value: false }; // 是否正在加載
      let hasMoreData = true; // 是否有更多資料

      async function fetchNews() {
        if (isLoading.value || !hasMoreData) return;

        isLoading.value = true;

        try {
          const response = await fetch("http://127.0.0.1:7000/api/ai_news", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ ai_model: 1, source_website: 1, offset }),
          });

          if (!response.ok) {
            throw new Error("Network response was not ok");
          }

          const data = await response.json();

          if (data.length === 0) {
            hasMoreData = false; // 沒有更多資料
            return;
          }

          const container = document.getElementById("news-container");

          data.forEach((news) => {
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
              <img src="${news.image_url}" alt="News Image" />
              <div class="card-content">
                <div class="card-title">${news.ai_title}</div>
                <div class="card-meta">${news.time} | 來源：${news.source_website}</div>
              </div>
            `;
            container.appendChild(card);
          });

          // 更新 offset
          offset += limit;
        } catch (error) {
          console.error("Error fetching news:", error);
        } finally {
          isLoading.value = false;
        }
      }

      // 滾動事件監聽
      window.addEventListener("scroll", () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 50) {
          fetchNews();
        }
      });

      // 初始化加載
      document.addEventListener("DOMContentLoaded", () => {
        fetchNews();
      });
    </script>
  </body>
</html>
